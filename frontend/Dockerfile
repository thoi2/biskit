# frontend/Dockerfile (ìš´ì˜ìš© ìµœì¢… ë²„ì „)

# ==================================================================
# Stage 1: Build the application (ë¹Œë“œ ë‹¨ê³„)
# ==================================================================
FROM node:18-alpine AS builder
WORKDIR /app

# ğŸ”½ğŸ”½ğŸ”½ ì´ ë¶€ë¶„ì„ ì¶”ê°€í•©ë‹ˆë‹¤ ğŸ”½ğŸ”½ğŸ”½
# docker-composeë¡œë¶€í„° build argsë¥¼ ë°›ê¸° ìœ„í•œ ì„ ì–¸
ARG NEXT_PUBLIC_GOOGLE_CLIENT_ID
ARG NEXT_PUBLIC_GOOGLE_REDIRECT_URI
ENV NEXT_PUBLIC_GOOGLE_CLIENT_ID=${NEXT_PUBLIC_GOOGLE_CLIENT_ID}
ENV NEXT_PUBLIC_GOOGLE_REDIRECT_URI=${NEXT_PUBLIC_GOOGLE_REDIRECT_URI}
# ğŸ”¼ğŸ”¼ğŸ”¼ ì—¬ê¸°ê¹Œì§€ ì¶”ê°€ ğŸ”¼ğŸ”¼ğŸ”¼

COPY package.json yarn.lock ./
RUN corepack enable && yarn install --frozen-lockfile
COPY . .
# Standalone ì¶œë ¥ì„ ìœ„í•´ next.config.jsì— output: 'standalone' ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
RUN yarn build


# ==================================================================
# Stage 2: Run the application (ì‹¤í–‰ ë‹¨ê³„)
# ==================================================================
FROM node:18-alpine AS runner

WORKDIR /app

# ë¹Œë“œ ë‹¨ê³„(builder)ì—ì„œ ìƒì„±ëœ ê²°ê³¼ë¬¼ë§Œ ë³µì‚¬í•´ì˜µë‹ˆë‹¤.
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static
COPY --from=builder /app/public ./public

# 3000ë²ˆ í¬íŠ¸ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤ê³  ëª…ì‹œí•©ë‹ˆë‹¤.
EXPOSE 3000

# Next.js Standalone ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
# server.jsëŠ” standalone ë¹Œë“œ ì‹œ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.
CMD ["node", "server.js"]